import React, { useEffect, useRef } from 'react';
import * as d3 from 'd3';

const ForceDirectedGraph = () => {
  const svgRef = useRef(null);

  useEffect(() => {
    const width = 900;
    const height = 300;

    const x = d3.scaleOrdinal()
      .domain([1, 2, 3, 4, 5])
      .range([50, 150, 250, 350, 450]);

    const color = d3.scaleOrdinal()
      .domain([1, 2, 3, 4, 5])
      .range(["#F8766D", "#00BA38", "#619CFF", "#FFC107", "#9C27B0"]);

    const data = [
      { "name": "ing", "group": 1, "size": 20 },
      { "name": "verbe", "group": 2, "size": 60 },
      { "name": "adj", "group": 3, "size": 40 },
      { "name": "nom", "group": 4, "size": 50 },
      { "name": "autre", "group": 5, "size": 30 }
    ];

    const svg = d3.select("#my_dataviz");

    // Remove existing SVG elements
    svg.selectAll('*').remove();

    // Append SVG
    const newSvg = svg
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    svgRef.current = newSvg.node();

    const node = d3.select(svgRef.current).selectAll("g")
      .data(data)
      .enter()
      .append("g")
      .attr("transform", d => `translate(${x(d.group)}, ${height / 2})`);

    // Ajouter le cercle à chaque groupe
    node.append("circle")
      .attr("r", d => d.size || 29)
      .style("fill", d => color(d.group))
      .style("fill-opacity", 0.8)
      .attr("stroke", "black")
      .style("stroke-width", 4);

    // Ajouter le texte centré à chaque groupe
    node.append("text")
      .text(d => d.name)
      .attr("text-anchor", "middle")
      .attr("dy", "0.3em")
      .style("fill", "black");

    const simulation = d3.forceSimulation(data)
      .force("x", d3.forceX().strength(0.5).x(d => x(d.group)))
      .force("y", d3.forceY().strength(0.1).y(height / 2))
      .force("center", d3.forceCenter().x(width / 2).y(height / 2))
      .force("charge", d3.forceManyBody().strength(1))
      .force("collide", d3.forceCollide().strength(.1).radius(d => d.size || 32).iterations(1));

    simulation
      .nodes(data)
      .on("tick", function () {
        node.attr("transform", d => `translate(${d.x || width / 2}, ${d.y || height / 2})`);
      });
  }, []);

  return <div id="my_dataviz"></div>;
};

export default ForceDirectedGraph;
